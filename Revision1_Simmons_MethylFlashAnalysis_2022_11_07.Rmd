---
title: "Revision 1 Simmons - MethylFlash Global DNAm Analysis"
author: "Gillian Goobie"
date: "2022/11/07"
output: 
  bookdown::html_document2:
    toc: yes
    toc_float: yes
    number_sections: yes
    code_folding: hide
  html_document: 
    toc: yes
    toc_float: yes
    number_sections: yes
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE, echo=F}
library(tidyverse)
library(readxl)
library(here)
library(writexl)
library(knitr)
library(lintr)
library(tidync)
library(maps)
library(ncmeta)
library(devtools)
library(RNetCDF)
library(ncdf4)
library(survival)
library(survminer)
library(lubridate)
library(cmprsk)
library(riskRegression)
library(prodlim)
library(RColorBrewer)
library(prodlim)
library(lme4)
library(performance)
library(psycho)
library(report)
library(rms)
library(splines)
library(Greg)
library(rstpm2)
library(pspline)
library(usethis)
library(betareg)
library(mediation)
library(GGally)
```

# Importing Datasets
## Total PM2.5 Files
Here I am importing the file which contains global DNAm estimates by ELISA-based MethylFlash that are linked to the patient ID.
```{r}
outfile1 <- here("Simmons_Results/Simmons_MethylFlash_ExptID_752-1091_2022_06_03.xlsx")
dnam <- read_excel(outfile1, sheet="CalculatedValues")
```

Match up PM25 data with methylation data
```{r}
outfile2 <- here("PM25_Data/Final_Simmons_fILD_PM_BaselineData_2022_03_28.xlsx")
PM <- read_excel(outfile2)
```

## Keep only required columns
```{r}
str(dnam)
dnam <- dnam %>% dplyr::select(WH_demID, exptID, sample_date, run_date, plate, pct_5mC)
```


## Join Columns
```{r}
dnam <- dnam %>% rename("ID"="WH_demID")
dnam <- left_join(dnam, PM, by="ID")
```

# Add Original PM2.5 Matching Files with All Months
```{r}
outfile2b <- here("PM25_Data/Simmons_fILD_2000_2018_PM25_2021_09_08.xlsx")
PM <- read_excel(outfile2b)
```

```{r}
dnam <- inner_join(PM, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
dnam <- dnam %>% dplyr::select(!c(PM_date, value))
```

## Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:232), names_to="PM_date", names_prefix="PM25_")
```

## Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$PM_date <- gsub("jan", "01-01-20", dnamx$PM_date)
dnamx$PM_date <- gsub("feb", "01-02-20", dnamx$PM_date)
dnamx$PM_date <- gsub("mar", "01-03-20", dnamx$PM_date)
dnamx$PM_date <- gsub("apr", "01-04-20", dnamx$PM_date)
dnamx$PM_date <- gsub("may", "01-05-20", dnamx$PM_date)
dnamx$PM_date <- gsub("jun", "01-06-20", dnamx$PM_date)
dnamx$PM_date <- gsub("jul", "01-07-20", dnamx$PM_date)
dnamx$PM_date <- gsub("aug", "01-08-20", dnamx$PM_date)
dnamx$PM_date <- gsub("sep", "01-09-20", dnamx$PM_date)
dnamx$PM_date <- gsub("oct", "01-10-20", dnamx$PM_date)
dnamx$PM_date <- gsub("nov", "01-11-20", dnamx$PM_date)
dnamx$PM_date <- gsub("dec", "01-12-20", dnamx$PM_date)

dnamx$PM_date <- format(as.Date(dnamx$PM_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$PM_date <- as.Date(dnamx$PM_date)
dnam <- dnamx
```


## Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("sample_date", "run_date", "dob", "death_date", "last_updated", "tx_date", "dx_date", "UPMC_lastvisit", "Simmons_lastvisit", "consent_date",  "pft_date", "deathORtx_date", "DeathTxCensor_date", "PM_date"), as.Date)
str(dnam)
```

## Remove unnecessary columns
```{r}
dnam <- dnam %>% dplyr::select(!c("nrow.x", "dist.x", "lon", "lat", "lat.x", "lon.x", "nrow.y", "dist.y", "lon.y", "lat.y"))
```


## Creating PM2.5 Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average PM value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(PM_1yrPreSamp = mean(value[ymd(PM_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(PM_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average PM value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(PM_3moPreSamp = mean(value[ymd(PM_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(PM_date)<=ymd(sample_date)]))
```


### Remove Dataframes not in use
```{r}
rm(list=c("dnamx"))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.

### Get rid of non-specific "value" column
```{r}
dnam <- dnam %>% dplyr::select(!value)
```


# Add PM2.5 Constituent Files
## SO4 add Original SO4 Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_SO4_2021_11_07.xlsx")
SO4 <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(SO4, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="SO4_date", names_prefix="SO4_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$SO4_date <- gsub("jan", "01-01-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("feb", "01-02-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("mar", "01-03-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("apr", "01-04-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("may", "01-05-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("jun", "01-06-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("jul", "01-07-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("aug", "01-08-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("sep", "01-09-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("oct", "01-10-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("nov", "01-11-20", dnamx$SO4_date)
dnamx$SO4_date <- gsub("dec", "01-12-20", dnamx$SO4_date)

dnamx$SO4_date <- format(as.Date(dnamx$SO4_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$SO4_date <- as.Date(dnamx$SO4_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("SO4_date"), as.Date)
str(dnam)
```

## Creating SO4 Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average SO4 value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(SO4_1yrPreSamp = mean(value[ymd(SO4_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(SO4_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average SO4 value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(SO4_3moPreSamp = mean(value[ymd(SO4_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(SO4_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "PM", "SO4"))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.

### Getting rid of unnecessary columns
```{r}
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, SO4_date, value))
```


## NO3 add Original NO3 Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_NO3_2021_11_05.xlsx")
NO3 <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(NO3, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="NO3_date", names_prefix="NIT_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$NO3_date <- gsub("jan", "01-01-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("feb", "01-02-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("mar", "01-03-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("apr", "01-04-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("may", "01-05-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("jun", "01-06-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("jul", "01-07-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("aug", "01-08-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("sep", "01-09-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("oct", "01-10-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("nov", "01-11-20", dnamx$NO3_date)
dnamx$NO3_date <- gsub("dec", "01-12-20", dnamx$NO3_date)

dnamx$NO3_date <- format(as.Date(dnamx$NO3_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$NO3_date <- as.Date(dnamx$NO3_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("NO3_date"), as.Date)
str(dnam)
```

## Creating NO3 Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average NO3 value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(NO3_1yrPreSamp = mean(value[ymd(NO3_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(NO3_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average NO3 value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(NO3_3moPreSamp = mean(value[ymd(NO3_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(NO3_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "NO3"))
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, value, NO3_date))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.


## NH4 add Original NH4 Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_NH4_2021_11_05.xlsx")
NH4 <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(NH4, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="NH4_date", names_prefix="NH4_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$NH4_date <- gsub("jan", "01-01-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("feb", "01-02-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("mar", "01-03-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("apr", "01-04-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("may", "01-05-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("jun", "01-06-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("jul", "01-07-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("aug", "01-08-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("sep", "01-09-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("oct", "01-10-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("nov", "01-11-20", dnamx$NH4_date)
dnamx$NH4_date <- gsub("dec", "01-12-20", dnamx$NH4_date)

dnamx$NH4_date <- format(as.Date(dnamx$NH4_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$NH4_date <- as.Date(dnamx$NH4_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("NH4_date"), as.Date)
str(dnam)
```

## Creating NH4 Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)


### 1yr Pre-Sampling
Here I am calculating the average NH4 value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(NH4_1yrPreSamp = mean(value[ymd(NH4_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(NH4_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average NH4 value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(NH4_3moPreSamp = mean(value[ymd(NH4_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(NH4_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "NH4"))
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, value, NH4_date))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.

## BC add Original BC Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_BC_2021_11_05.xlsx")
BC <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(BC, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="BC_date", names_prefix="BC_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$BC_date <- gsub("jan", "01-01-20", dnamx$BC_date)
dnamx$BC_date <- gsub("feb", "01-02-20", dnamx$BC_date)
dnamx$BC_date <- gsub("mar", "01-03-20", dnamx$BC_date)
dnamx$BC_date <- gsub("apr", "01-04-20", dnamx$BC_date)
dnamx$BC_date <- gsub("may", "01-05-20", dnamx$BC_date)
dnamx$BC_date <- gsub("jun", "01-06-20", dnamx$BC_date)
dnamx$BC_date <- gsub("jul", "01-07-20", dnamx$BC_date)
dnamx$BC_date <- gsub("aug", "01-08-20", dnamx$BC_date)
dnamx$BC_date <- gsub("sep", "01-09-20", dnamx$BC_date)
dnamx$BC_date <- gsub("oct", "01-10-20", dnamx$BC_date)
dnamx$BC_date <- gsub("nov", "01-11-20", dnamx$BC_date)
dnamx$BC_date <- gsub("dec", "01-12-20", dnamx$BC_date)

dnamx$BC_date <- format(as.Date(dnamx$BC_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$BC_date <- as.Date(dnamx$BC_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("BC_date"), as.Date)
str(dnam)
```

## Creating BC Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average BC value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(BC_1yrPreSamp = mean(value[ymd(BC_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(BC_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average BC value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(BC_3moPreSamp = mean(value[ymd(BC_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(BC_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "BC"))
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, value, BC_date))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.


## OM add Original OM Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_OM_2021_11_05.xlsx")
OM <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(OM, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="OM_date", names_prefix="OM_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$OM_date <- gsub("jan", "01-01-20", dnamx$OM_date)
dnamx$OM_date <- gsub("feb", "01-02-20", dnamx$OM_date)
dnamx$OM_date <- gsub("mar", "01-03-20", dnamx$OM_date)
dnamx$OM_date <- gsub("apr", "01-04-20", dnamx$OM_date)
dnamx$OM_date <- gsub("may", "01-05-20", dnamx$OM_date)
dnamx$OM_date <- gsub("jun", "01-06-20", dnamx$OM_date)
dnamx$OM_date <- gsub("jul", "01-07-20", dnamx$OM_date)
dnamx$OM_date <- gsub("aug", "01-08-20", dnamx$OM_date)
dnamx$OM_date <- gsub("sep", "01-09-20", dnamx$OM_date)
dnamx$OM_date <- gsub("oct", "01-10-20", dnamx$OM_date)
dnamx$OM_date <- gsub("nov", "01-11-20", dnamx$OM_date)
dnamx$OM_date <- gsub("dec", "01-12-20", dnamx$OM_date)

dnamx$OM_date <- format(as.Date(dnamx$OM_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$OM_date <- as.Date(dnamx$OM_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("OM_date"), as.Date)
str(dnam)
```

## Creating OM Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average OM value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(OM_1yrPreSamp = mean(value[ymd(OM_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(OM_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average OM value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(OM_3moPreSamp = mean(value[ymd(OM_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(OM_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "OM"))
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, value, OM_date))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.


## SS add Original SS Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_SS_2021_11_05.xlsx")
SS <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(SS, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="SS_date", names_prefix="SS_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$SS_date <- gsub("jan", "01-01-20", dnamx$SS_date)
dnamx$SS_date <- gsub("feb", "01-02-20", dnamx$SS_date)
dnamx$SS_date <- gsub("mar", "01-03-20", dnamx$SS_date)
dnamx$SS_date <- gsub("apr", "01-04-20", dnamx$SS_date)
dnamx$SS_date <- gsub("may", "01-05-20", dnamx$SS_date)
dnamx$SS_date <- gsub("jun", "01-06-20", dnamx$SS_date)
dnamx$SS_date <- gsub("jul", "01-07-20", dnamx$SS_date)
dnamx$SS_date <- gsub("aug", "01-08-20", dnamx$SS_date)
dnamx$SS_date <- gsub("sep", "01-09-20", dnamx$SS_date)
dnamx$SS_date <- gsub("oct", "01-10-20", dnamx$SS_date)
dnamx$SS_date <- gsub("nov", "01-11-20", dnamx$SS_date)
dnamx$SS_date <- gsub("dec", "01-12-20", dnamx$SS_date)

dnamx$SS_date <- format(as.Date(dnamx$SS_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$SS_date <- as.Date(dnamx$SS_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("SS_date"), as.Date)
str(dnam)
```

## Creating SS Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average SS value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(SS_1yrPreSamp = mean(value[ymd(SS_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(SS_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average SS value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(SS_3moPreSamp = mean(value[ymd(SS_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(SS_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "SS"))
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, value, SS_date))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 233 observations.


## Soil add Original Soil Matching Files with All Months
```{r}
outfile3 <- here("PM25_Data/Simmons_fILD_2000_2017_soil_2021_11_05.xlsx")
Soil <- read_excel(outfile3)
```

```{r}
dnam <- inner_join(Soil, dnam, by="ID")
```

Reorder so "ID" is the first column
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

### Pivoting to Long Format
First we need to convert the PM dataframe into the long rather than the wide format, which will allow us to use it more easily in R's tidyverse as this is "tidy" formatting.
```{r}
dnam <- dnam %>% 
  pivot_longer(cols=c(6:221), names_to="Soil_date", names_prefix="soil_", names_repair = "minimal")
```

### Convert date PM_date to same format as above
```{r}
dnamx <- dnam 
dnamx$Soil_date <- gsub("jan", "01-01-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("feb", "01-02-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("mar", "01-03-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("apr", "01-04-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("may", "01-05-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("jun", "01-06-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("jul", "01-07-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("aug", "01-08-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("sep", "01-09-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("oct", "01-10-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("nov", "01-11-20", dnamx$Soil_date)
dnamx$Soil_date <- gsub("dec", "01-12-20", dnamx$Soil_date)

dnamx$Soil_date <- format(as.Date(dnamx$Soil_date, format="%d-%m-%Y"),"%Y-%m-%d")
dnamx$Soil_date <- as.Date(dnamx$Soil_date)
dnam <- dnamx
```


# Convert Date Columns to Date Format
Next I need to convert all date columns to proper format
```{r}
dnam <- dnam %>% 
  mutate_at(c("Soil_date"), as.Date)
str(dnam)
```

## Creating Soil Exposure Variables
Now I'm creating new variables where I am matching up PM averages per year to years of major events for patients (year of diagnosis, year of death/lung transplant/censoring, etc)

### 1yr Pre-Sampling
Here I am calculating the average Soil value in the 1yr prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(Soil_1yrPreSamp = mean(value[ymd(Soil_date)>=(ymd(sample_date) - years(1)) & 
                                        ymd(Soil_date)<=ymd(sample_date)]))
```

### 3mo Pre-Sampling
Here I am calculating the average Soil value in the 3mo prior to sampling.
```{r}
dnam <- dnam %>% 
  group_by(ID) %>% 
  mutate(Soil_3moPreSamp = mean(value[ymd(Soil_date)>=(ymd(sample_date) - months(3)) & 
                                        ymd(Soil_date)<=ymd(sample_date)]))
```

### Remove Dataframes and variables not in use
```{r}
rm(list=c("dnamx", "Soil"))
dnam <- dnam %>% dplyr::select(!c(nrow, dist, lon, lat, value, Soil_date))
```

### Getting Rid of Duplicated IDs
Now that we have calculated the patient-specific PM exposures, I can get rid of all rows other than the first row for each patient.
```{r}
dnam <-  dnam %>% 
  distinct_at(vars(ID), .keep_all=T)
```
This takes us down to 317 observations.



## Reorder columns
```{r}
dnam <- dnam %>% dplyr::select(ID, everything(.))
```

## Remove extreme outliers
```{r}
dnam <- dnam %>% filter(pct_5mC<5)
```
This takes us down to 313 observations.

# Make Dichotomized PM2.5
## 1yr Pre-Sampling
```{r}
dnam$PM1yrSamp_dich <- cut(dnam$PM_1yrPreSamp,
                      breaks=c(0, 8, 100),
                      labels=c("Low", "High"))
summary(dnam$PM1yrSamp_dich)
class(dnam$PM1yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$PM3moSamp_dich <- cut(dnam$PM_3moPreSamp,
                      breaks=c(0, 8, 100),
                      labels=c("Low", "High"))
summary(dnam$PM3moSamp_dich)
class(dnam$PM3moSamp_dich)
```

# Make Dichotomized SO4
## 1yr Pre-Sampling
```{r}
dnam$SO41yrSamp_dich <- cut(dnam$SO4_1yrPreSamp,
                      breaks=c(0, 1.5, 100),
                      labels=c("Low", "High"))
summary(dnam$SO41yrSamp_dich)
class(dnam$SO41yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$SO43moSamp_dich <- cut(dnam$SO4_3moPreSamp,
                      breaks=c(0, 1.5, 100),
                      labels=c("Low", "High"))
summary(dnam$SO43moSamp_dich)
class(dnam$SO43moSamp_dich)
```

# Make Dichotomized NO3
## 1yr Pre-Sampling
```{r}
dnam$NO31yrSamp_dich <- cut(dnam$NO3_1yrPreSamp,
                      breaks=c(0, 0.84, 100),
                      labels=c("Low", "High"))
summary(dnam$NO31yrSamp_dich)
class(dnam$NO31yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$NO33moSamp_dich <- cut(dnam$NO3_3moPreSamp,
                      breaks=c(0, 0.78, 100),
                      labels=c("Low", "High"))
summary(dnam$NO33moSamp_dich)
class(dnam$NO33moSamp_dich)
```


# Make Dichotomized NH4
## 1yr Pre-Sampling
```{r}
dnam$NH41yrSamp_dich <- cut(dnam$NH4_1yrPreSamp,
                      breaks=c(0, 0.5, 100),
                      labels=c("Low", "High"))
summary(dnam$NH41yrSamp_dich)
class(dnam$NH41yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$NH43moSamp_dich <- cut(dnam$NH4_3moPreSamp,
                      breaks=c(0, 0.5, 100),
                      labels=c("Low", "High"))
summary(dnam$NH43moSamp_dich)
class(dnam$NH43moSamp_dich)
```


# Make Dichotomized BC
## 1yr Pre-Sampling
```{r}
dnam$BC1yrSamp_dich <- cut(dnam$BC_1yrPreSamp,
                      breaks=c(0, 0.73, 100),
                      labels=c("Low", "High"))
summary(dnam$BC1yrSamp_dich)
class(dnam$BC1yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$BC3moSamp_dich <- cut(dnam$BC_3moPreSamp,
                      breaks=c(0, 0.72, 100),
                      labels=c("Low", "High"))
summary(dnam$BC3moSamp_dich)
class(dnam$BC3moSamp_dich)
```


# Make Dichotomized OM
## 1yr Pre-Sampling
```{r}
dnam$OM1yrSamp_dich <- cut(dnam$OM_1yrPreSamp,
                      breaks=c(0, 3.13, 100),
                      labels=c("Low", "High"))
summary(dnam$OM1yrSamp_dich)
class(dnam$OM1yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$OM3moSamp_dich <- cut(dnam$OM_3moPreSamp,
                      breaks=c(0, 3.05, 100),
                      labels=c("Low", "High"))
summary(dnam$OM3moSamp_dich)
class(dnam$OM3moSamp_dich)
```


# Make Dichotomized SS
## 1yr Pre-Sampling
```{r}
dnam$SS1yrSamp_dich <- cut(dnam$SS_1yrPreSamp,
                      breaks=c(0, 0.21, 100),
                      labels=c("Low", "High"))
summary(dnam$SS1yrSamp_dich)
class(dnam$SS1yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$SS3moSamp_dich <- cut(dnam$SS_3moPreSamp,
                      breaks=c(0, 0.2, 100),
                      labels=c("Low", "High"))
summary(dnam$SS3moSamp_dich)
class(dnam$SS3moSamp_dich)
```


# Make Dichotomized Soil
## 1yr Pre-Sampling
```{r}
dnam$Soil1yrSamp_dich <- cut(dnam$Soil_1yrPreSamp,
                      breaks=c(0, 0.5, 100),
                      labels=c("Low", "High"))
summary(dnam$Soil1yrSamp_dich)
class(dnam$Soil1yrSamp_dich)
```

## 3mo Pre-Sampling
```{r}
dnam$Soil3moSamp_dich <- cut(dnam$Soil_3moPreSamp,
                      breaks=c(0, 0.45, 100),
                      labels=c("Low", "High"))
summary(dnam$Soil3moSamp_dich)
class(dnam$Soil3moSamp_dich)
```


# Export File with All PM2.5 and Constituent Time Frames Matched
```{r}
write_xlsx(dnam, path="Simmons_fILD_PM25andConstituentsMatched_forMethylFlash_2022_11_07.xlsx")
```

# Releveling Factors
Here I am releveling factors so that they are in an intuitive order for my later analyses.
```{r}
dnam$sex <- fct_relevel(dnam$sex, c("M","F"))
dnam$race <- fct_relevel(dnam$race, c("W","B","A","U"))
dnam$ethnicity <- fct_relevel(dnam$ethnicity, c("N","H","U"))
dnam$dich_Race <- fct_relevel(dnam$dich_Race, c("White","Non-White"))
dnam$smokeHx <- fct_relevel(dnam$smokeHx, c("Never","Ever"))

#For dx and dx_group, I just want IPF to be first and then the rest of the categories are alphabetical
dnam$dx <- fct_relevel(dnam$dx, c("IPF"))
dnam$dx_group <- fct_relevel(dnam$dx_group, c("IPF"))
dnam$dx_IPF <- fct_relevel(dnam$dx_IPF, c("IPF"))
#dnam$PM5yrCensor_dich <- fct_relevel(dnam$PM5yrCensor_dich, c("Low"))
#dnam$PM5yr_dich <- fct_relevel(dnam$PM5yr_dich, c("Low"))
#dnam$SO45yrCensor_dich <- fct_relevel(dnam$SO45yrCensor_dich, c("Low"))
#dnam$SO45yr_dich <- fct_relevel(dnam$SO45yr_dich, c("Low"))
#dnam$NO35yrCensor_dich <- fct_relevel(dnam$NO35yrCensor_dich, c("Low"))
#dnam$NO35yr_dich <- fct_relevel(dnam$NO35yr_dich, c("Low"))
#dnam$NH45yrCensor_dich <- fct_relevel(dnam$NH45yrCensor_dich, c("Low"))
#dnam$NH45yr_dich <- fct_relevel(dnam$NH45yr_dich, c("Low"))
#dnam$BC5yrCensor_dich <- fct_relevel(dnam$BC5yrCensor_dich, c("Low"))
#dnam$BC5yr_dich <- fct_relevel(dnam$BC5yr_dich, c("Low"))
#dnam$OM5yrCensor_dich <- fct_relevel(dnam$OM5yrCensor_dich, c("Low"))
#dnam$OM5yr_dich <- fct_relevel(dnam$OM5yr_dich, c("Low"))
#dnam$SS5yrCensor_dich <- fct_relevel(dnam$SS5yrCensor_dich, c("Low"))
#dnam$SS5yr_dich <- fct_relevel(dnam$SS5yr_dich, c("Low"))
#dnam$Soil5yrCensor_dich <- fct_relevel(dnam$Soil5yrCensor_dich, c("Low"))
#dnam$Soil5yr_dich <- fct_relevel(dnam$Soil5yr_dich, c("Low"))
str(dnam)
```

# Creating New Variables
## Time between Registry Enrollment and Sample Date
Need to know if consent_date is a reasonable time point to be basing our DNAm results from
```{r}
dnam <- dnam %>% mutate(time_sample=(sample_date-consent_date)/365.25)
dnam$time_sample <- as.numeric(dnam$time_sample)
```

## Proportion %5mC
Will need to use the actual proportion of 5mC for beta regression analyses where values must be between 0 and 1
```{r}
dnam <- dnam %>% mutate(prop_5mC=pct_5mC/100)
```

## Region of the U.S.
```{r}
dnam$State <- as.factor(dnam$State)
dnam <- dnam %>% mutate(region=case_when(State %in% c("CA", "CO") ~ "West",
                                         State %in% c("IL", "MI", "OH") ~ "Midwest",
                                         State %in% c("MA", "MD", "ME", "NY", "PA") ~ "Northeast",
                                         State %in% c("FL", "GA", "KY", "NC", "SC", "VA", "WV") ~ "Southeast"))
```

# Extracting Excel File
```{r}
colnames(dnam)

PM_data <- dnam %>% dplyr::select(ID, pct_5mC, prop_5mC, PM_1yrPreSamp, PM_3moPreSamp, SO4_1yrPreSamp, SO4_3moPreSamp, NO3_1yrPreSamp, NO3_3moPreSamp, NH4_1yrPreSamp, NH4_3moPreSamp,BC_1yrPreSamp, BC_3moPreSamp, OM_1yrPreSamp, OM_3moPreSamp, SS_1yrPreSamp, SS_3moPreSamp, Soil_1yrPreSamp,Soil_3moPreSamp)

write_xlsx(PM_data, "Simmons_PM25andConstituentMatching_MethylFlash_2022_11_07.xlsx")
```



# Exploratory Data Analysis
This is a function that allows me to make tables which summarize the count and percentages of each level of factor variables
```{r}
n_prop_tbl <- function(x) {
  tbl <- table(x)
  res <- cbind(tbl, round(prop.table(tbl)*100,2))
  colnames(res) <-  c('Count', 'Percentage')
  res
}
```


## PM Breakdown 
```{r}
print("PM2.5")
summary(dnam$PM_1yrPreSamp)
summary(dnam$PM_3moPreSamp)

print("/nSO4")
summary(dnam$SO4_1yrPreSamp)
summary(dnam$SO4_3moPreSamp)

print("/nNO3")
summary(dnam$NO3_1yrPreSamp)
summary(dnam$NO3_3moPreSamp)

print("/nNH4")
summary(dnam$NH4_1yrPreSamp)
summary(dnam$NH4_3moPreSamp)

print("/nBC")
summary(dnam$BC_1yrPreSamp)
summary(dnam$BC_3moPreSamp)

print("/nOM")
summary(dnam$OM_1yrPreSamp)
summary(dnam$OM_3moPreSamp)

print("/nSS")
summary(dnam$SS_1yrPreSamp)
summary(dnam$SS_3moPreSamp)

print("/nSoil")
summary(dnam$Soil_1yrPreSamp)
summary(dnam$Soil_3moPreSamp)
```

## Sex Breakdown
```{r}
n_prop_tbl(dnam$sex)
```

## Race and Ethnicity Breakdown 
```{r}
n_prop_tbl(dnam$race)

n_prop_tbl(dnam$ethnicity)
```

## Smoking History Breakdown
```{r}
n_prop_tbl(dnam$smokeHx)
```


## Diagnostic Group Breakdown
```{r}
n_prop_tbl(dnam$dx_group)
```


## State Breakdown
```{r}
n_prop_tbl(dnam$State)
```

## Region Breakdown
```{r}
n_prop_tbl(dnam$region)
```


## Metropolitan Breakdown
```{r}
n_prop_tbl(dnam$metro)
```
Overwhelming majority of the patients are considered "metropolitan".

## Age at Diagnosis Breakdown
```{r}
shapiro.test(dnam$age_dx)
#Shapiro tests tells us that age_dx is not normally distributed, so should report median, IQR
summary(dnam$age_dx)
```
Not normally distributed.

## Vital Status Breakdown
```{r}
n_prop_tbl(dnam$status)
```


## Baseline Lung Function Breakdown
```{r}
shapiro.test(dnam$fvc_pct)
summary(dnam$fvc_pct)
sd(dnam$fvc_pct, na.rm=T)
```

```{r}
shapiro.test(dnam$dlco_pct)
summary(dnam$dlco_pct)
sd(dnam$dlco_pct, na.rm=T)
```

## Time to Censoring Breakdown
```{r}
summary(dnam$time_DeathTxCensor)
sd(dnam$time_DeathTxCensor, na.rm=T)
```

## Time between registry enrollment and sample collection
```{r}
summary(dnam$time_sample)
sd(dnam$time_sample, na.rm=T)
```
This indicates that the majority of samples are taken very close to the time of consent, which is our reference for the _5yrPreDx periods for exposure matching, although there are a few where samples were taken far before or far after the consent_date.

## pct_5mC
```{r}
shapiro.test(dnam$pct_5mC)
summary(dnam$pct_5mC)
sd(dnam$pct_5mC, na.rm=T)
```

# Visual Exploratory Data Analysis
## Histograms
Histogram of %5mC
```{r}
(dnam %>% ggplot(aes(x=pct_5mC))+
   geom_histogram(fill="blue", color="black")+
   labs(x="% 5mC", y="Number of patients with IPF", title="% 5mC in Patients with IPF")+
   theme(plot.title = element_text(hjust = 0.5)))
```
We have some very high outliers, whreas the rest is generally <1%

Histogram of %5mC
```{r}
(dnam %>% ggplot(aes(x=pct_5mC))+
   geom_histogram(fill="blue", color="black")+
   labs(x="% 5mC", y="Number of patients with IPF", title="% 5mC in Patients with IPF")+
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,0.5))
```
Right-skewed distribution.

## Scatterplots
### Scatterplot Matrix
PM2.5 and other pollutants in 1yr pre-sampling
```{r}
colnames(dnam)
ggpairs(dnam, columns=c(6, 62, 64, 66, 68, 70, 72, 74, 76))
```

### PM2.5 Scatterplots
Scatterplot of continuous PM2.5 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=PM_1yrPreSamp, y=pct_5mC))+
   geom_point()+
   labs(x="PM2.5 in 1yr Pre-Sampling", y="% 5mC", title="%5mC by PM2.5 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     
   scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(5, 17)+
   ylim(0, 1.5))
```

Scatterplot of continuous PM2.5 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=PM_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="PM2.5 in 3mo Pre-Sampling", y="% 5mC", title="%5mC by PM2.5 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,20)+
   ylim(0, 1.5))
```

## SO4 Scatterplots
Scatterplot of continuous SO4 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=SO4_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="SO4 in 1yr Pre-Sampling", y="% 5mC", title="%5mC by SO4 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,8)+
   ylim(0, 1.5))
```


Scatterplot of continuous SO4 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=SO4_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="SO4 in 3mo Pre-Sampling", y="% 5mC", title="%5mC by SO4 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,8)+
   ylim(0, 1.5))
```


### NO3 Scatterplots
Scatterplot of continuous NO3 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=NO3_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="NO3 in 1yrs Pre-Sampling", y="% 5mC", title="%5mC by NO3 1yrs Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,5)+
   ylim(0, 1.5))
```

Scatterplot of continuous NO3 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=NO3_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="NO3 in 3mo Pre-Sampling", y="% 5mC", title="%5mC by NO3 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,5)+
   ylim(0, 1.5))
```


### NH4 Scatterplots
Scatterplot of continuous NH4 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=NH4_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="NH4 in 1yr Pre-Sampling", y="% 5mC", title="%5mC by NH4 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0, 3)+
   ylim(0, 1.5))
```

Scatterplot of continuous NH4 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=NH4_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="NH4 in 3mo Pre-Sampling", y="% 5mC", title="%5mC by NH4 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,3)+
   ylim(0, 1.5))
```


### BC Scatterplots
Scatterplot of continuous BC 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=BC_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="BC in 1yr Pre-Sampling", y="% 5mC", title="%5mC by BC 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0, 2)+
   ylim(0, 1.5))
```

Scatterplot of continuous BC 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=BC_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="BC in 3mo Pre-Sampling", y="% 5mC", title="%5mC by BC 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,2)+
   ylim(0, 1.5))
```


### OM Scatterplots
Scatterplot of continuous OM 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=OM_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="OM in 1yr Pre-Sampling", y="% 5mC", title="%5mC by OM 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0, 8)+
   ylim(0, 1.5))
```

Scatterplot of continuous OM 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=OM_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="OM in 3mo Pre-Sampling", y="% 5mC", title="%5mC by OM 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,10)+
   ylim(0, 1.5))
```

## SS Scatterplots
Scatterplot of continuous SS 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=SS_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="SS in 1yr Pre-Sampling", y="% 5mC", title="%5mC by SS 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0, 1)+
   ylim(0, 1.5))
```

Scatterplot of continuous SS 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=SS_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="SS in 3mo Pre-Sampling", y="% 5mC", title="%5mC by SS 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,2)+
   ylim(0, 1.5))
```


### Soil Scatterplots
Scatterplot of continuous Soil 1yr Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=Soil_1yrPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="Soil in 1yr Pre-Sampling", y="% 5mC", title="%5mC by Soil 1yr Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0, 1.5)+
   ylim(0, 1.5))
```

Scatterplot of continuous Soil 3mo Pre-Sampling vs %5mC
```{r}
(dnam %>% ggplot(aes(x=Soil_3moPreSamp, y=pct_5mC, color=sex))+
   geom_point()+
   labs(x="Soil in 3mo Pre-Sampling", y="% 5mC", title="%5mC by Soil 3mo Pre-Sampling")+
   geom_smooth(method="lm", se = FALSE) +
   theme(plot.title = element_text(hjust = 0.5))+     scale_fill_manual(values=c("dodgerblue1", "firebrick1"))+
   xlim(0,1.5)+
   ylim(0, 1.5))
```



# Violin Plots of DNAm and PM2.5/Constituents by Region
## 5mC
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=pct_5mC, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="% 5mC", title="% 5mC by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5))+
    ylim(0.05,0.25))
```
Higher %5mC  in Midwest


## PM2.5
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=PM_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="PM2.5 in 1yrs Pre-Sampling", title="PM2.5 in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```

## SO4
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=SO4_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="SO4 in 1yrs Pre-Sampling", title="SO4 in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```

## NO3
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=NO3_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="NO3 in 1yrs Pre-Sampling", title="NO3 in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```

## NH4
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=NH4_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="NH4 in 1yrs Pre-Sampling", title="NH4 in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```


## BC
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=BC_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="BC in 1yrs Pre-Sampling", title="BC in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```


## OM
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=OM_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="OM in 1yrs Pre-Sampling", title="OM in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```


## SS
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=SS_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="SS in 1yrs Pre-Sampling", title="SS in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```


## Soil
```{r}
dnamb <- dnam %>% filter(!is.na(region))
(dnamb %>% ggplot(aes(x=region, y=Soil_1yrPreSamp, fill=region))+
    geom_boxplot(width=0.2, color="black", alpha=1.0)+
    geom_violin(width=1.0, alpha=0.5)+
    labs(x="Region of U.S.", y="Soil in 1yrs Pre-Sampling", title="Soil in 1yrs Pre-Sampling by Region")+
    theme_light()+
    theme(legend.position = "none", plot.title = element_text(hjust = 0.5)))
```


# Linear Regression Analyses
## PM2.5 Models
### Continuous PM2.5 1yr Pre-Sampling
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Higher PM_1yrPreSamp assoc with increased prop_5mC in this model.**

Impact of sex on model
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp + sex, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
*Higher PM_1yrPreSamp marginally assoc with increased prop_5mC in this model.*

Impact of age_dx on model
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp + age_dx, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Higher PM_1yrPreSamp assoc with increased prop_5mC in this model.**

Impact of smokeHx on model
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp + smokeHx, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
*Higher PM_1yrPreSamp marginally assoc with increased prop_5mC in this model.*

Impact of race on model
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp + dich_Race, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Higher PM_1yrPreSamp assoc with increased prop_5mC in this model.**

Impact of urbanicity on model
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp + metro, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
*Higher PM_1yrPreSamp marginally assoc with increased prop_5mC in this model.*


Partial model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ PM_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
*Higher PM_1yrPreSamp marginally assoc with increased prop_5mC in this model.*


Complete model with age_dx, sex, smokeHx, race, urbanicity
```{r}
dnam_model3 <- betareg(prop_5mC ~ PM_1yrPreSamp + sex + age_dx + smokeHx + dich_Race + metro, data=dnam)
summary(dnam_model3)
confint(dnam_model3)  
nobs(dnam_model3)
```
*Higher PM_1yrPreSamp marginally assoc with increased prop_5mC in this model.*

### Dichotomized PM2.5 in 1yr Pre-Sampling
Base Model
```{r}
dnam_model1 <- betareg(prop_5mC ~PM1yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between high PM2.5 and prop_5mC in this model.

Partial model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ PM1yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between PM1yrSamp_dich and prop_5mC in this model.


Complete model with age_dx, sex, smokeHx, race, urbanicity
```{r}
dnam_model3 <- betareg(prop_5mC ~ PM1yrSamp_dich + sex + age_dx + smokeHx + dich_Race + metro, data=dnam)
summary(dnam_model3)
confint(dnam_model3)  
nobs(dnam_model3)
```
No significant association between PM1yrSamp_dich and prop_5mC in this model.



### Continuous PM2.5 3mo Pre-Sample
```{r}
dnam_model1 <- betareg(prop_5mC ~ PM_3moPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between PM_3moPreSamp and increased prop_5mC in this model.**

Partial model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ PM_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between PM_3moPreSamp and increased prop_5mC in this model.**


Complete model with age_dx, sex, smokeHx, race, urbanicity
```{r}
dnam_model3 <- betareg(prop_5mC ~ PM_3moPreSamp + sex + age_dx + smokeHx + dich_Race + metro, data=dnam)
summary(dnam_model3)
confint(dnam_model3)  
nobs(dnam_model3)
```
*Marginal association between PM_3moPreSamp and increased prop_5mC in this model.*

### Dichotomized PM2.5 in 3mo Pre-Sampling
Base Model
```{r}
dnam_model1 <- betareg(prop_5mC ~PM3moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between high PM2.5 and prop_5mC in this model.

Partial model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ PM3moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between PM3moSamp_dich and prop_5mC in this model.


Complete model with age_dx, sex, smokeHx, race, urbanicity
```{r}
dnam_model3 <- betareg(prop_5mC ~ PM3moSamp_dich + sex + age_dx + smokeHx + dich_Race + metro, data=dnam)
summary(dnam_model3)
confint(dnam_model3)  
nobs(dnam_model3)
```
No significant association between PM3moSamp_dich and prop_5mC in this model.


## SO4 Models
### Continuous SO4 in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ SO4_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between SO4_1yrPreSamp and increased prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SO4_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between SO4_1yrPreSamp and increased prop_5mC in this model.**

### Dichotomized SO4 in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~SO41yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between SO41yrSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SO41yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between SO41yrSamp_dich and prop_5mC in this model.


### Continuous SO4 in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ SO4_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between SO4_3moPreSamp and increased prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SO4_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between SO4_3moPreSamp and increased prop_5mC in this model.**

### Dichotomized SO4 in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~SO43moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between SO43moSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SO43moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between SO43moSamp_dich and prop_5mC in this model.


## NO3 Models
### Continuous NO3 in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ NO3_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between NO3_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NO3_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between NO3_1yrPreSamp and prop_5mC in this model.


### Dichotomized NO3 in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~NO31yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No association between high NO31yrSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NO31yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No association between NO31yrSamp_dich and prop_5mC in this model.


### Continuous NO3 in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ NO3_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between NO3_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NO3_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between NO3_3moPreSamp and prop_5mC in this model.


### Dichotomized NO3 in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~NO33moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between NO33moSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NO33moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between NO33moSamp_dich and prop_5mC in this model.


## NH4 Models
### Continuous NH4 in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ NH4_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between NH4_1yrPreSamp and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NH4_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between NH4_1yrPreSamp and higher prop_5mC in this model.**

### Dichotomized NH4 in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~NH41yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between NH41yrSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NH41yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between NH41yrSamp_dich and prop_5mC in this model.


### Continuous NH4 in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ NH4_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between NH4_3moPreSamp and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NH4_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between NH4_3moPreSamp and higher prop_5mC in this model.**


### Dichotomized NH4 in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~NH43moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between NH43moSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ NH43moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between NH43moSamp_dich and prop_5mC in this model.


## BC Models
### Continuous BC in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ BC_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between BC_1yrPreSamp and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ BC_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between BC_1yrPreSamp and higher prop_5mC in this model.**

### Dichotomized BC in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~BC1yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between BC1yrSamp_dichHigh and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ BC1yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between BC1yrSamp_dichHigh and higher prop_5mC in this model.**


### Continuous BC in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ BC_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between BC_3moPreSamp and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ BC_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between BC_3moPreSamp and higher prop_5mC in this model.**


### Dichotomized BC in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~BC3moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
**Significant association between BC3moSamp_dichHigh and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ BC3moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
**Significant association between BC3moSamp_dichHigh and higher prop_5mC in this model.**


## OM Models
### Continuous OM in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ OM_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between OM_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ OM_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between OM_1yrPreSamp and prop_5mC in this model.

### Dichotomized OM in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~OM1yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between OM1yrSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ OM1yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between OM1yrSamp_dich and prop_5mC in this model.


### Continuous OM in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ OM_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between OM_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ OM_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between OM_3moPreSamp and prop_5mC in this model.


### Dichotomized OM in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~OM3moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between OM3moSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ OM3moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between OM3moSamp_dich and prop_5mC in this model.


## SS Models
### Continuous SS in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ SS_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between SS_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SS_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between SS_1yrPreSamp and prop_5mC in this model.


### Dichotomized SS in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~SS1yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between SS1yrSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SS1yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between SS1yrSamp_dich and prop_5mC in this model.

### Continuous SS in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ SS_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between SS_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SS_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between SS_3moPreSamp and prop_5mC in this model.

### Dichotomized SS in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~SS3moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between SS3moSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ SS3moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between SS3moSamp_dich and prop_5mC in this model.


## Soil Models
### Continuous Soil in 1yrs Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ Soil_1yrPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between Soil_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ Soil_1yrPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between Soil_1yrPreSamp and prop_5mC in this model.


### Dichotomized Soil in 1yr Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~Soil1yrSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between Soil1yrSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ Soil1yrSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between Soil1yrSamp_dich and prop_5mC in this model.


### Continuous Soil in 3mo Pre-Sampling
Unadjusted model
```{r}
dnam_model1 <- betareg(prop_5mC ~ Soil_3moPreSamp, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between Soil_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ Soil_3moPreSamp + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between Soil_3moPreSamp and prop_5mC in this model.

### Dichotomized Soil in 3mo Pre-Sampling
Unadjusted Model
```{r}
dnam_model1 <- betareg(prop_5mC ~Soil3moSamp_dich, data=dnam)
summary(dnam_model1)
confint(dnam_model1)  
nobs(dnam_model1)
```
No significant association between Soil3moSamp_dich and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
dnam_model2 <- betareg(prop_5mC ~ Soil3moSamp_dich + sex + age_dx + smokeHx, data=dnam)
summary(dnam_model2)
confint(dnam_model2)  
nobs(dnam_model2)
```
No significant association between Soil3moSamp_dich and prop_5mC in this model.


# Impact of DNAm on Mortality
Base model
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant association between %5mC and mortality in this model.

Partial Model
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant association between %5mC and mortality in this model.

Complete Model
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant association between %5mC and mortality in this model.

# Impact of PM2.5 on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~PM1yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="PM2.5 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High PM2.5 in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
Small numbers in low exposure group, but clearly high exposure curve lower.

Base model with just PM2.5
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher PM_1yrPreSamp and increased mortality in this model.**

Base model with PM2.5 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher PM_1yrPreSamp and increased mortality in this model with slight reduction in HR by introduction of pct_5mC to model, suggesting small amount of mediation.**

Partial Model with just PM2.5
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher PM_1yrPreSamp and increased mortality in this model.**

Partial Model with PM2.5 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher PM_1yrPreSamp and increased mortality in this model with slight reduction in HR by introduction of pct_5mC to model, suggesting small amount of mediation.**

Complete Model with just PM2.5
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between PM_1yrPreSamp and mortality in this model.

Complete Model with PM2.5 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between PM_1yrPreSamp and mortality in this model.



## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~PM3moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="PM2.5 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High PM2.5 in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High exposure group clearly lower.

Base model with just PM2.5
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between increased PM_3moPreSamp and increased mortality in this model.**

Base model with PM2.5 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between increased PM_3moPreSamp and increased mortality in this model, and HR decreases slightly when pct_5mC added indicating that DNAm may mediate a portion of the assoc between PM2.5 and mort.**

Partial Model with just PM2.5
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between increased PM_3moPreSamp and increased mortality in this model.**

Partial Model with PM2.5 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between increased PM_3moPreSamp and increased mortality in this model, and HR decreases slightly when pct_5mC added indicating that DNAm may mediate a portion of the assoc between PM2.5 and mort.**

Complete Model with just PM2.5
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between PM_3moPreSamp and mortality in this model.

Complete Model with PM2.5 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between PM_3moPreSamp and mortality in this model.


# Impact of SO4 on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~SO41yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="SO4 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High SO4 in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High exposure curve clearly lower.

Base model with just SO4
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher SO4_1yrPreSamp and increased mortality in this model.**

Base model with SO4 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher SO4_1yrPreSamp and increased mortality in this model, and HR decreases when pct_5mC added indicating that DNAm may mediate a portion of the SO4-mortality association.**

Partial Model with just SO4
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher SO4_1yrPreSamp and increased mortality in this model.**

Partial Model with SO4 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher SO4_1yrPreSamp and increased mortality in this model, and HR decreases when pct_5mC added indicating that DNAm may mediate a portion of the SO4-mortality association.**

Complete Model with just SO4
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SO4_1yrPreSamp and mortality in this model.

Complete Model with SO4 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SO4_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~SO43moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="SO4 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High SO4 in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High exposure curve clearly lower.

Base model with just SO4
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher SO4_3moPreSamp and increased mortality in this model.**

Base model with SO4 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher SO4_3moPreSamp and increased mortality in this model, and HR decreases when pct_5mC added indicating that DNAm may mediate a portion of the SO4-mortality association.**

Partial Model with just SO4
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher SO4_3moPreSamp and increased mortality in this model.**

Partial Model with SO4 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher SO4_3moPreSamp and increased mortality in this model, and HR decreases when pct_5mC added indicating that DNAm may mediate a portion of the SO4-mortality association.**

Complete Model with just SO4
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SO4_3moPreSamp and mortality in this model.

Complete Model with SO4 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SO4_3moPreSamp and mortality in this model.


# Impact of NO3 on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~NO31yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="NO3 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High NO3 in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High exposure curve generally lower.

Base model with just NO3
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher NO3_1yrPreSamp and increased mortality in this model.**

Base model with NO3 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between higher NO3_1yrPreSamp and increased mortality in this model, and HR decreases with addition of pct_5mC to models indicating it mediates  portion of the NO3-mortality association.**

Partial Model with just NO3
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher NO3_1yrPreSamp and increased mortality in this model.**

Partial Model with NO3 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between higher NO3_1yrPreSamp and increased mortality in this model, and HR decreases with addition of pct_5mC to models indicating it mediates  portion of the NO3-mortality association.**

Complete Model with just NO3
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between NO3_1yrPreSamp and mortality in this model.

Complete Model with NO3 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between NO3_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~NO33moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="NO3 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High NO3 in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
Low exposure curve appears slightly lower.

Base model with just NO3
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No assoc between NO3_3moPreSamp and mortality in this model

Base model with NO3 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No assoc between NO3_3moPreSamp and mortality in this model

Partial Model with just NO3
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No assoc between NO3_3moPreSamp and mortality in this model

Partial Model with NO3 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No assoc between NO3_3moPreSamp and mortality in this model

Complete Model with just NO3
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No assoc between NO3_3moPreSamp and mortality in this model

Complete Model with NO3 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NO3_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No assoc between NO3_3moPreSamp and mortality in this model


# Impact of NH4 on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~NH41yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="NH4 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High NH4 in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High NH4 curve clearly lower.

Base model with just NH4
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between NH4_1yrPreSamp and increased mortality in this model.**

Base model with NH4 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between NH4_1yrPreSamp and increased mortality in this model, with reduction in HR when pct_5mC added to model indicating component of mediation by DNAm.**

Partial Model with just NH4
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between NH4_1yrPreSamp and increased mortality in this model.**

Partial Model with NH4 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between NH4_1yrPreSamp and increased mortality in this model, with reduction in HR when pct_5mC added to model indicating component of mediation by DNAm.**

Complete Model with just NH4
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between NH4_1yrPreSamp and mortality in this model.

Complete Model with NH4 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between NH4_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~NH43moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="NH4 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High NH4 in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High exposure curve clearly lower

Base model with just NH4
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between NH4_3moPreSamp and increased mortality in this model.**

Base model with NH4 and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
**Significant assoc between NH4_3moPreSamp and increased mortality in this model, with reduction in HR when pct_5mC added to model indicating component of mediation by DNAm.**

Partial Model with just NH4
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between NH4_3moPreSamp and increased mortality in this model.**

Partial Model with NH4 and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
**Significant assoc between NH4_3moPreSamp and increased mortality in this model, with reduction in HR when pct_5mC added to model indicating component of mediation by DNAm.**

Complete Model with just NH4
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between NH4_3moPreSamp and mortality in this model.

Complete Model with NH4 and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between NH4_3moPreSamp and mortality in this model.


# Impact of BC on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~BC1yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="BC 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High BC in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```
High curve appears lower.

Base model with just BC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between BC_1yrPreSamp and mortality in this model.

Base model with BC and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between BC_1yrPreSamp and mortality in this model.

Partial Model with just BC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between BC_1yrPreSamp and mortality in this model.

Partial Model with BC and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between BC_1yrPreSamp and mortality in this model.

Complete Model with just BC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between BC_1yrPreSamp and mortality in this model.

Complete Model with BC and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between BC_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~BC3moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="BC 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High BC in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```


Base model with just BC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between BC_3moPreSamp and mortality in this model.

Base model with BC and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between BC_3moPreSamp and mortality in this model.

Partial Model with just BC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between BC_3moPreSamp and mortality in this model.

Partial Model with BC and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between BC_3moPreSamp and mortality in this model.

Complete Model with just BC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between BC_3moPreSamp and mortality in this model.

Complete Model with BC and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ BC_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between BC_3moPreSamp and mortality in this model.


# Impact of OM on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~OM1yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="OM 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High OM in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```

Base model with just OM
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between OM_1yrPreSamp and mortality in this model.

Base model with OM and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between OM_1yrPreSamp and mortality in this model.

Partial Model with just OM
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between OM_1yrPreSamp and mortality in this model.

Partial Model with OM and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between OM_1yrPreSamp and mortality in this model.

Complete Model with just OM
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between OM_1yrPreSamp and mortality in this model.

Complete Model with OM and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between OM_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~OM3moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="OM 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High OM in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```


Base model with just OM
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No assoc between higher OM_3moPreSamp and mortality in this model.

Base model with OM and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No assoc between higher OM_3moPreSamp and mortality in this model.


Partial Model with just OM
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No assoc between higher OM_3moPreSamp and mortality in this model.

Partial Model with OM and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No assoc between higher OM_3moPreSamp and mortality in this model.

Complete Model with just OM
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
*Marginal assoc between higher OM_3moPreSamp and lower mortality in this model.*

Complete Model with OM and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ OM_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
*Marginal assoc between higher OM_3moPreSamp and lower mortality in this model with HR decreasing when pct_5mC added indicating some mediation effect.*


# Impact of SS on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~SS1yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="SS 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High SS in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```

Base model with just SS
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between SS_1yrPreSamp and mortality in this model.

Base model with SS and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between SS_1yrPreSamp and mortality in this model.

Partial Model with just SS
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between SS_1yrPreSamp and mortality in this model.

Partial Model with SS and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between SS_1yrPreSamp and mortality in this model.

Complete Model with just SS
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SS_1yrPreSamp and mortality in this model.

Complete Model with SS and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SS_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~SS3moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="SS 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High SS in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```


Base model with just SS
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between SS_3moPreSamp and mortality in this model.

Base model with SS and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between SS_3moPreSamp and mortality in this model.

Partial Model with just SS
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between SS_3moPreSamp and mortality in this model.

Partial Model with SS and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between SS_3moPreSamp and mortality in this model.

Complete Model with just SS
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SS_3moPreSamp and mortality in this model.

Complete Model with SS and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ SS_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No significant assoc between SS_3moPreSamp and mortality in this model.


# Impact of Soil on Mortality
## 1yr Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~Soil1yrSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="Soil 1yr \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High Soil in 1yr Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```

Base model with just Soil
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_1yrPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No assoc between increased Soil_1yrPreSamp and mortality in this model.

Base model with Soil and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_1yrPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No assoc between increased Soil_1yrPreSamp and mortality in this model.

Partial Model with just Soil
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_1yrPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No assoc between increased Soil_1yrPreSamp and mortality in this model.

Partial Model with Soil and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No assoc between increased Soil_1yrPreSamp and mortality in this model.

Complete Model with just Soil
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_1yrPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No assoc between increased Soil_1yrPreSamp and mortality in this model.

Complete Model with Soil and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_1yrPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
No assoc between increased Soil_1yrPreSamp and mortality in this model.


## 3mo Pre-Sampling
```{r, fig.height=5, fig.width=7}
surv1 <- survfit(Surv(time_DeathTxCensor, deadORtx==1) ~Soil3moSamp_dich, data=dnam)
(ggsurvplot(surv1, 
            censor=TRUE,
            pval=TRUE,
            xlim=c(0,10),
            legend="right",
           data=dnam,
           legend.title="Soil 3mo \nPre-Sampling",
           legend.labs=c("Low", "High"),
           risk.table=F,
           title="Time to Death or Transplant by Low vs High Soil in 3mo Pre-Sampling",
           xlab="Time from Diagnosis (years)",
           ylab="Survival Probability (Death or Lung Transplant)",
           ggtheme = theme_grey()
           ))
```


Base model with just Soil
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_3moPreSamp, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between Soil_3moPreSamp and mortality in this model.

Base model with Soil and pct_5mC
```{r}
coxPH_model1 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_3moPreSamp + pct_5mC, data=dnam, id=ID)
summary(coxPH_model1)
```
No significant assoc between Soil_3moPreSamp and mortality in this model.

Partial Model with just Soil
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_3moPreSamp + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between Soil_3moPreSamp and mortality in this model.

Partial Model with Soil and pct_5mC
```{r}
coxPH_model2 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_3moPreSamp + pct_5mC + age_dx + sex + smokeHx, data=dnam, id=ID)
summary(coxPH_model2)
```
No significant assoc between Soil_3moPreSamp and mortality in this model.

Complete Model with just Soil
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_3moPreSamp + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
**Significant assoc between Soil_3moPreSamp and lower mortality in this model.**

Complete Model with Soil and pct_5mC
```{r}
coxPH_model3 <- coxph(Surv(time_DeathTxCensor, deadORtx==1) ~ Soil_3moPreSamp + pct_5mC + age_dx + sex + smokeHx + dich_Race + fvc_pct + dlco_pct, data=dnam, id=ID)
summary(coxPH_model3)
```
**Significant assoc between Soil_3moPreSamp and mortality in this model with HR reduced when pct_5mC added to model indicating some mediation.**


# Impact of DNAm on Baseline FVC
Base Model
```{r}
FVC_model1 <- lm(fvc_pct ~ pct_5mC, data=dnam)
summary(FVC_model1)
confint(FVC_model1)
```
No significant association between %5mC and baseline FVC.

Partial Model
```{r}
FVC_model2 <- lm(fvc_pct ~ pct_5mC + sex + age_dx, data=dnam)
summary(FVC_model2)
confint(FVC_model2)
```
No significant association between %5mC and baseline FVC.

Complete Model
```{r}
FVC_model3 <- lm(fvc_pct ~ pct_5mC + sex + age_dx + dich_Race + smokeHx, data=dnam)
summary(FVC_model3)
confint(FVC_model3)
```
No significant association between %5mC and baseline FVC.


# Impact of DNAm on Baseline DLCO
Base Model
```{r}
DLCO_model1 <- lm(dlco_pct ~ pct_5mC, data=dnam)
summary(DLCO_model1)
confint(DLCO_model1)
```
No significant association between %5mC and baseline DLCO

Partial Model
```{r}
DLCO_model2 <- lm(dlco_pct ~ pct_5mC + sex + age_dx, data=dnam)
summary(DLCO_model2)
confint(DLCO_model2)
```
No significant association between %5mC and baseline DLCO

Complete Model
```{r}
DLCO_model3 <- lm(dlco_pct ~ pct_5mC + sex + age_dx + dich_Race + smokeHx, data=dnam)
summary(DLCO_model3)
confint(DLCO_model3)
```
No significant association between %5mC and baseline DLCO.


# Mediation Analyses
Using the mediation package in R, I will perform causal mediation analyses of prop_5mC's role as a causal mediator of the relationship between PM2.5 or constituent components and mortality. 

The two models used in these analyses will be:
1) Linear model of association of pollutant with prop_5mC
2) Cox PH model of association of pollutant and prop_5mC with mortality (both pollutant and prop_5mC in same model, along with other established covariates).

Only performing these analyses on the models where association of pollutant with prop_5mC is significant and where association of pollutant with mortality is significant.

## PM2.5 in 1yr pre-sampling
### Unadjusted model
Unadjusted linear model for assoc of PM_1yrPreSamp with prop_5mC
```{r}
dnam_model1 <- lm(prop_5mC ~ PM_1yrPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
```

Unadjusted parametric survival model for assoc of PM_1yrPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model1 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + prop_5mC, data=dnam)
summary(surv_model1)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model1, surv_model1, treat="PM_1yrPreSamp", mediator="prop_5mC")
summary(med1)
```


### Partially-Adjusted model
Unadjusted linear model for assoc of PM_1yrPreSamp with prop_5mC
```{r}
dnam_model2 <- lm(prop_5mC ~ PM_1yrPreSamp + age_dx + sex + smokeHx, dnam)
summary(dnam_model2)
confint(dnam_model2)  
```

Unadjusted parametric survival model for assoc of PM_1yrPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model2 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_1yrPreSamp + prop_5mC + age_dx + sex + smokeHx, data=dnam)
summary(surv_model2)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model2, surv_model2, treat="PM_1yrPreSamp", mediator="prop_5mC")
summary(med1)
```

## PM2.5 in 3mo pre-sampling
### Unadjusted model
Unadjusted linear model for assoc of PM_3moPreSamp with prop_5mC
```{r}
dnam_model1 <- lm(prop_5mC ~ PM_3moPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
```

Unadjusted parametric survival model for assoc of PM_3moPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model1 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + prop_5mC, data=dnam)
summary(surv_model1)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model1, surv_model1, treat="PM_3moPreSamp", mediator="prop_5mC")
summary(med1)
```

### Partially-Adjusted model
Unadjusted linear model for assoc of PM_3moPreSamp with prop_5mC
```{r}
dnam_model2 <- lm(prop_5mC ~ PM_3moPreSamp + age_dx + sex + smokeHx, dnam)
summary(dnam_model2)
confint(dnam_model2)  
```

Unadjusted parametric survival model for assoc of PM_3moPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model2 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ PM_3moPreSamp + prop_5mC + age_dx + sex + smokeHx, data=dnam)
summary(surv_model2)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model2, surv_model2, treat="PM_3moPreSamp", mediator="prop_5mC")
summary(med1)
```



## SO4 in 1yr pre-sampling
### Unadjusted model
Unadjusted linear model for assoc of SO4_1yrPreSamp with prop_5mC
```{r}
dnam_model1 <- lm(prop_5mC ~ SO4_1yrPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
```

Unadjusted parametric survival model for assoc of SO4_1yrPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model1 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + prop_5mC, data=dnam)
summary(surv_model1)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model1, surv_model1, treat="SO4_1yrPreSamp", mediator="prop_5mC")
summary(med1)
```

### Partially-Adjusted model
Unadjusted linear model for assoc of SO4_1yrPreSamp with prop_5mC
```{r}
dnam_model2 <- lm(prop_5mC ~ SO4_1yrPreSamp + age_dx + sex + smokeHx, dnam)
summary(dnam_model2)
confint(dnam_model2)  
```

Unadjusted parametric survival model for assoc of SO4_1yrPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model2 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_1yrPreSamp + prop_5mC + age_dx + sex + smokeHx, data=dnam)
summary(surv_model2)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model2, surv_model2, treat="SO4_1yrPreSamp", mediator="prop_5mC")
summary(med1)
```


## SO4 in 3mo pre-sampling
### Unadjusted model
Unadjusted linear model for assoc of SO4_3moPreSamp with prop_5mC
```{r}
dnam_model1 <- lm(prop_5mC ~ SO4_3moPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
```

Unadjusted parametric survival model for assoc of SO4_3moPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model1 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + prop_5mC, data=dnam)
summary(surv_model1)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model1, surv_model1, treat="SO4_3moPreSamp", mediator="prop_5mC")
summary(med1)
```

### Partially-Adjusted model
Unadjusted linear model for assoc of SO4_3moPreSamp with prop_5mC
```{r}
dnam_model2 <- lm(prop_5mC ~ SO4_3moPreSamp + age_dx + sex + smokeHx, dnam)
summary(dnam_model2)
confint(dnam_model2)  
```

Unadjusted parametric survival model for assoc of SO4_3moPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model2 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ SO4_3moPreSamp + prop_5mC + age_dx + sex + smokeHx, data=dnam)
summary(surv_model2)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model2, surv_model2, treat="SO4_3moPreSamp", mediator="prop_5mC")
summary(med1)
```


## NH4 in 1yr pre-sampling
### Unadjusted model
Unadjusted linear model for assoc of NH4_1yrPreSamp with prop_5mC
```{r}
dnam_model1 <- lm(prop_5mC ~ NH4_1yrPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
```

Unadjusted parametric survival model for assoc of NH4_1yrPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model1 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + prop_5mC, data=dnam)
summary(surv_model1)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model1, surv_model1, treat="NH4_1yrPreSamp", mediator="prop_5mC")
summary(med1)
```

### Partially-Adjusted model
Unadjusted linear model for assoc of NH4_1yrPreSamp with prop_5mC
```{r}
dnam_model2 <- lm(prop_5mC ~ NH4_1yrPreSamp + age_dx + sex + smokeHx, dnam)
summary(dnam_model2)
confint(dnam_model2)  
```

Unadjusted parametric survival model for assoc of NH4_1yrPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model2 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_1yrPreSamp + prop_5mC + age_dx + sex + smokeHx, data=dnam)
summary(surv_model2)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model2, surv_model2, treat="NH4_1yrPreSamp", mediator="prop_5mC")
summary(med1)
```


## NH4 in 3mo pre-sampling
### Unadjusted model
Unadjusted linear model for assoc of NH4_3moPreSamp with prop_5mC
```{r}
dnam_model1 <- lm(prop_5mC ~ NH4_3moPreSamp, dnam)
summary(dnam_model1)
confint(dnam_model1)  
```

Unadjusted parametric survival model for assoc of NH4_3moPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model1 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + prop_5mC, data=dnam)
summary(surv_model1)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model1, surv_model1, treat="NH4_3moPreSamp", mediator="prop_5mC")
summary(med1)
```

### Partially-Adjusted model
Unadjusted linear model for assoc of NH4_3moPreSamp with prop_5mC
```{r}
dnam_model2 <- lm(prop_5mC ~ NH4_3moPreSamp + age_dx + sex + smokeHx, dnam)
summary(dnam_model2)
confint(dnam_model2)  
```

Unadjusted parametric survival model for assoc of NH4_3moPreSamp and prop_5mC with mortality (mediation package does not take coxph object, but will take survreg object)
```{r}
surv_model2 <- survreg(Surv(time_DeathTxCensor, deadORtx==1) ~ NH4_3moPreSamp + prop_5mC + age_dx + sex + smokeHx, data=dnam)
summary(surv_model2)
```

```{r}
set.seed(100)
med1 <- mediate(dnam_model2, surv_model2, treat="NH4_3moPreSamp", mediator="prop_5mC")
summary(med1)
```


# Sensitivity Analysis with Non-Smokers - Linear Regression
```{r}
nonsmoke <- dnam %>% filter(smokeHx=="Never") 
```


## PM2.5 Models
### Continuous PM2.5 1yr Pre-Sampling
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ PM_1yrPreSamp, nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
Higher PM_1yrPreSamp trends towards increased prop_5mC in this model, but no longer significant with smaller sample size.

Partial model with age_dx, sex
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ PM_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
*Higher PM_1yrPreSamp marginally assoc with increased prop_5mC in this model.*


### Continuous PM2.5 3mo Pre-Sample
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ PM_3moPreSamp, nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
Trends towards increased PM_3moPreSamp being assoc with increased prop_5mC in this model.

Partial model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ PM_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
*Marginal association between PM_3moPreSamp and increased prop_5mC in this model.*

## SO4 Models
### Continuous SO4 in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ SO4_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
**Significant association between SO4_1yrPreSamp and increased prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ SO4_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
**Significant association between SO4_1yrPreSamp and increased prop_5mC in this model.**

### Continuous SO4 in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ SO4_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
**Significant association between SO4_3moPreSamp and increased prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ SO4_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
**Significant association between SO4_3moPreSamp and increased prop_5mC in this model.**


## NO3 Models
### Continuous NO3 in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ NO3_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between NO3_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ NO3_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between NO3_1yrPreSamp and prop_5mC in this model.


### Continuous NO3 in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ NO3_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between NO3_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ NO3_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between NO3_3moPreSamp and prop_5mC in this model.

## NH4 Models
### Continuous NH4 in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ NH4_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
**Significant association between NH4_1yrPreSamp and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ NH4_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
**Significant association between NH4_1yrPreSamp and higher prop_5mC in this model.**

### Continuous NH4 in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ NH4_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
**Significant association between NH4_3moPreSamp and higher prop_5mC in this model.**

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ NH4_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
**Significant association between NH4_3moPreSamp and higher prop_5mC in this model.**


## BC Models
### Continuous BC in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ BC_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
Trends towards higher BC_1yrPreSamp being assoc with higher prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ BC_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
*Marginal association between BC_1yrPreSamp and higher prop_5mC in this model.*

### Continuous BC in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ BC_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
*Marginal association between higher BC_3moPreSamp and higher prop_5mC in this model.*

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ BC_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
**Significant association between BC_3moPreSamp and higher prop_5mC in this model.**


## OM Models
### Continuous OM in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ OM_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between OM_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ OM_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between OM_1yrPreSamp and prop_5mC in this model.

### Continuous OM in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ OM_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between OM_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ OM_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between OM_3moPreSamp and prop_5mC in this model.


## SS Models
### Continuous SS in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ SS_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between SS_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ SS_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between SS_1yrPreSamp and prop_5mC in this model.

### Continuous SS in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ SS_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between SS_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ SS_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between SS_3moPreSamp and prop_5mC in this model.

## Soil Models
### Continuous Soil in 1yrs Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ Soil_1yrPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between Soil_1yrPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ Soil_1yrPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between Soil_1yrPreSamp and prop_5mC in this model.


### Continuous Soil in 3mo Pre-Sampling
Unadjusted model
```{r}
nonsmoke_model1 <- betareg(prop_5mC ~ Soil_3moPreSamp, data=nonsmoke)
summary(nonsmoke_model1)
confint(nonsmoke_model1)  
nobs(nonsmoke_model1)
```
No significant association between Soil_3moPreSamp and prop_5mC in this model.

Adjusted model with age_dx, sex, smokeHx
```{r}
nonsmoke_model2 <- betareg(prop_5mC ~ Soil_3moPreSamp + sex + age_dx, data=nonsmoke)
summary(nonsmoke_model2)
confint(nonsmoke_model2)  
nobs(nonsmoke_model2)
```
No significant association between Soil_3moPreSamp and prop_5mC in this model.


